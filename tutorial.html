<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>

  <title>Perl Ocean</title>

  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="google-code-prettify/sons-of-obsidian.css" rel="stylesheet">
</head>

<body>

  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
        <a class="brand" href="#">Perl Ocean</a>
        <div class="nav-collapse">
          <ul class="nav">
            <li>
              <a href="index.html">Home</a>
            </li>
            <li class="active">
              <a href="#">Getting Started</a>
            </li>
            <li>
              <a href="protocol.html">Protocol</a>
            </li>
            <li>
              <a href="development.html">Development</a>
            </li>
            <li>
              <a href="cluster.html">Cluster</a>
            </li>
            <li>
              <a href="media.html">Media Support</a>
            </li>
            <li>
              <a href="client.html">Client Libraries</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="subnav">
      <ul class="nav nav-tabs">
        <li><a href="installation.html">インストール</a></li>
        <li class="active"><a href="#">チュートリアル</a></li>
      </ul>
    </div>
  </div>

  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span3">
        <div class="well sidebar-nav">
          <ul class="nav nav-list">
            <li class="nav-header">目次</li>
            <li><a href="#section1">スタンドアロンプロジェクト</a></li>
            <li><a href="#section2">プロジェクトテンプレート</a></li>
            <li><a href="#section3">設定ファイルの編集</a></li>
            <li><a href="#section4">サーバーの起動</a></li>
            <li><a href="#section5">iChatで確認</a></li>
          </ul>
        </div><!--/.well -->
      </div><!--/span-->

      <div class="span9">

        <div class="row-fluid">
          <div class="span12">
            <h2 id="section1">スタンドアロンプロジェクトの実験</h2>
            <p>Oceanでは、Webサービスとのインテグレーションを主目的としています。ただし、Webサービスと連携をしない、単体でのサービスも提供することが出来ます。ここでは、そのようなプロジェクトのことを、スタンドアロンプロジェクトと呼ぶことにします。スタンドアロンプロジェクトでは、データベースなどは自動で用意され、非常に簡単にサービスを開始することが可能です。</p>

            <p>特にWebサービスとの連携が必要なく、小規模での利用が目的の場合は、スタンドアロンプロジェクトが最適です。</p>

            <p>まずはOceanの使い方の感覚をつかむために、スタンドアロンプロジェクトでサーバーを起動し、Jabber/XMPPプロトコルをサポートするクライアントアプリケーションから実際につないでみましょう。</p>

            <p>この例では、MacOSXで実験を行い、クライアントアプリケーションにはMacOSXに標準で付属しているiChatを利用してみます。</p>
          </div><!--/span-->
        </div><!--/row-->

        <div class="row-fluid">
          <div class="span12">
            <h2 id="section2">プロジェクトテンプレートの作成</h2>
            <p>Oceanのインストールが完了すると、いくつかのコマンドが使えるようになります。</p>
            <p>まずは、任意のディレクトリに移動し、次のように <b>ocean-standalone</b> コマンドを打ってみましょう</p>

            <pre>ocean-standalone</pre>

            <img src="img/getting_started/prompt.png"/>

            <p>対話方式のシェルの開始されるので、任意に回答を打ち込むと、それに従ってプロジェクトテンプレートが生成されます。ここでは仮に、最初のプロジェクト名の問いに対して <b>foo</b> と回答することにします。残りの問いには、何も回答せずにEnterを押し、デフォルトの設定にします。</p>
            <img src="img/getting_started/prompt2.png"/>

            <img src="img/getting_started/prompt3.png"/>

            <p>カレントディレクトリ内に、新たにfooディレクトリが生成され、さらにその下に、様々なファイルが生成されたことを確認して下さい。このfooディレクトリが、<b>プロジェクトルートディレクトリ</b>となります。</p>

          </div>
        </div>
        <div class="row-fluid">
          <div class="span12">
            <h2 id="section3">設定ファイルの編集</h2>
            <p>fooの中に移動します。</p>
            <pre>cd ./foo</pre>
            <p>スタンドアロンプロジェクトでは、</p>
            <ul>
              <li><b>コンフィグファイルの編集</b></li> 
              <li><b>フィクスチャデータの編集</b></li> 
              <li><b>起動コマンドの実行</b></li> 
            </ul>
            <p>という三つの段階を踏むだけで、簡単にサービスを開始することが出来ます。</p>
            <p>まずはコンフィグファイルを編集してみましょう。</p>
            <p>コンフィグファイルは、必要最低限のものがデフォルト値で埋められた状態で生成されています。</p>
            <p>場所は、<b>プロジェクトルートディレクトリ/config/xmpp.yml</b>になります。</p>
            <p>では早速編集してみましょう。</p>

            <pre>vi ./config/xmpp.yml</pre>

            <pre class="prettyprint linenums lang-yaml">
---
server:
  type: xmpp
  domain:
    - xmpp.example.org
  host: 192.168.0.1
  port: 5222
  backlog: 1024
  max_connection: 100000
  timeout: 300
  timeout_preauth: 10
  max_read_buffer: 10000
  report_interval: 60
  use_stanza_counter: yes
  stanza_counter_expiration: 60
  max_stanza_count: 1000
  pid_file: __path_to(var/run/xmpp.pid)__
  context_class: Foo::Context

log:
  type: print
  formatter: color
  level: info
  show_packets: yes
  filepath: __path_to(var/log/xmpp.log)__

sasl:
  mechanisms:
    - PLAIN
    - X-OAUTH2
#   - CRAM-MD5
#   - DIGEST-MD5

#tls:
#  cert_file: __path_to(certs/cert.pem)__
#  key_file: __path_to(certs/server.nopass.key)__
#  cipher_list: ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:-LOW:-SSLv2:-EXP:+eNULL

event_handler:
  node:       Foo::Handler::Node
  authen:     Foo::Handler::Authen
  connection: Foo::Handler::Connection
  message:    Foo::Handler::Message
  people:     Foo::Handler::People
  room:       Foo::Handler::Room
  p2p:        Foo::Handler::P2P

handler:
  db_file_path: __path_to(db/database.db)__</pre>

            <p>hostを <b>192.168.0.1</b> から、<b>127.0.0.1</b> に変更し、domainを、<b>xmpp.example.org</b>から、<b>localhost</b> に変更しておきます。</p>

            <pre class="prettyprint linenums:2 lang-yaml">
server:
  type: xmpp
  domain:
    - localhost
  host: 127.0.0.1
  port: 5222
  backlog: 1024</pre>

            <p>次に、<b>フィクスチャファイル</b>を覗いてみます。</p>
            <p>ファイルパスは、<b>プロジェクトルートディレクトリ/config/fixture.yml</b>です。</p>

            <pre>vi ./config/fixture.yml</pre>

            <pre class="prettyprint linenums lang-yaml">
users:
    - id:               user_01
      username:         kusanagi
      nickname:         Kusanagi
      password:         foobar
      oauth_token:      aaaaaa
      profile_img_file: __path_to(asset/img/example01.jpg)__
    - id:               user_02 
      username:         aramaki
      nickname:         Aramaki
      password:         foobar
      oauth_token:      bbbbbb
      profile_img_file: __path_to(asset/img/example02.jpg)__
    - id:               user_03 
      username:         batou
      nickname:         Batou
      password:         foobar
      oauth_token:      cccccc
      profile_img_file: __path_to(asset/img/example03.jpg)__
    - id:               user_04 
      username:         togusa
      nickname:         Togusa
      password:         foobar
      oauth_token:      dddddd
      profile_img_file: __path_to(asset/img/example04.jpg)__
    - id:               user_05 
      username:         ishikawa
      nickname:         Ishikawa
      password:         foobar
      oauth_token:      eeeeee
      profile_img_file: __path_to(asset/img/example05.jpg)__
    - id:               user_06 
      username:         saito
      nickname:         Saito
      password:         foobar
      oauth_token:      ffffff
      profile_img_file: __path_to(asset/img/example06.jpg)__
    - id:               user_07 
      username:         paz
      nickname:         Paz
      password:         foobar
      oauth_token:      gggggg
      profile_img_file: __path_to(asset/img/example07.jpg)__
    - id:               user_08 
      username:         borma
      nickname:         Borma
      password:         foobar
      oauth_token:      hhhhhh
      profile_img_file: __path_to(asset/img/example08.jpg)__
relations:
    - follower: user_01</pre>

            <p>ユーザー名、ニックネーム、プロフィール画像等、ユーザーの最低限の情報が設定されていることがわかります。プロジェクトテンプレート生成時に、8人のデモユーザーが登録されています。</p>
            <p>必要であれば、このファイルを編集して、ユーザーの追加、削除、編集を行います。</p>
            <p>今回は、デフォルト状態のままデモユーザーを使用して進めることにして、変更は加えずにファイルの編集を終わります。</p>
            <p>これで準備が出来ました。</p>
          </div>
        </div>

        <div class="row-fluid">
          <div class="span12">
            <h2 id="section4">サーバーの起動</h2>
            <p>起動するときは、次のように <b>プロジェクトルートディレクトリ/bin/ocean-start</b>スクリプトを実行します。</p>

            <pre>perl ./bin/ocean-start</pre>

            <img src="img/getting_started/starter.png"/>

            <p>ログが流れ始めました。サーバーを起動することが出来たのが分かります。</p>

          </div>
        </div>
        <div class="row-fluid">
          <div class="span12">
            <h2 id="section5">iChatで確認</h2>
            <p>では次に、iChatを起動してみましょう。</p>
            <p>対話の実験のために、ユーザー二人分を登録します。</p>

            <img src="img/getting_started/ichat_account.png"/>

            <p>アカウント管理画面左下の「+」ボタンを押してユーザーを追加します。</p>
            <p>次のように設定項目を埋めて、新規アカウントを登録します。</p>

            <img src="img/getting_started/ichat_account2.png"/>

            <p>パスワードにはfoobarを入れます。デフォルトで作成されるデモユーザーの初期パスワードは全てfoobarになっています。これは上記のフィクスチャファイルで設定されています。(今回は実験なのでこのままパスワードを利用しますが、実運用する際には勿論パスワードは変更することが推奨されます。)</p>

            <p>同様にもう一人登録します。</p>

            <img src="img/getting_started/ichat_account3.png"/>

            <p>アカウント欄を確認すると、二つのアカウントが追加されたことが分かります。</p>

            <img src="img/getting_started/ichat_account4.png"/>

            <p>アカウントをダブルクリックしてウィンドウを開き、現在の状態を「チャット可能」にしてみます。</p>
            <img src="img/getting_started/ichat_account5.png"/>

            <p>ウィンドウがログイン状態になりました。</p>
            <p>オフラインの友人がグレーで表示されているのがわかるでしょうか。</p>

            <img src="img/getting_started/ichat_account6.png"/>

            <p>サーバー側でログが流れていることを確認しておきましょう。</p>

            <img src="img/getting_started/ichat_account7.png"/>

            <p>同様にもう一人のユーザーも、状態を「チャット可能」にしてログインしてみます。</p>

            <img src="img/getting_started/ichat_account8.png"/>

            <p>kusanagiとaramaki、お互いに相手がログイン状態になっていることが確認できます。</p>
            <p>相手に話しかけてみましょう。</p>

            <img src="img/getting_started/ichat_account9.png"/>

            <p>対話できることが確認できたでしょうか</p>

            <img src="img/getting_started/ichat_account10.png"/>

            <p>このように、スタンドアロンプロジェクトを利用すると、非常に簡単にJabber/XMPPのサービスを開始することが可能です。</p>

          </div><!--/span-->
        </div><!--/row-->

      </div><!--/span-->
    </div><!--/row-->

    <hr />
    <footer>
      <p>&copy; Lyo Kato 2012</p>
    </footer>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="google-code-prettify/prettify.js"></script>
  <script type="text/javascript">
    $(function(){
      prettyPrint();
    });
  </script>
</body>
</html>
